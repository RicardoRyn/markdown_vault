# æ¡Œé¢ç¯å¢ƒå®‰è£…

æ»šï¼Œéƒ½å¯ä»¥æ»šï¼

```bash
pacman -Syu # å‡çº§ç³»ç»Ÿä¸­å…¨éƒ¨åŒ…
```

é€šè¿‡ `vim ~/.bash_profile` è¾“å…¥ï¼š

```bash
export EDITOR='vim'
```

## 1. æ–°å»ºérootç”¨æˆ·

```bash
useradd -m -G wheel -s /bin/bash ricardo
```

> `-m`: åˆ›å»ºç”¨æˆ·çš„ home ç›®å½•ï¼ˆ/home/ricardoï¼‰ï¼Œå¦‚æœæ²¡æœ‰å°±æ–°å»ºã€‚
> `-G wheel`: å°†ç”¨æˆ·åŠ å…¥é™„åŠ ç»„ wheelã€‚wheel ç»„åœ¨ Linux ä¸­é€šå¸¸ç”¨äº å…è®¸ä½¿ç”¨ sudoã€‚
> `-s /bin/bash`: æŒ‡å®šç”¨æˆ·ç™»å½•æ—¶çš„ é»˜è®¤ shell ä¸º bashã€‚

è®¾ç½®ç”¨æˆ·å¯†ç ï¼š

```bash
passwd ricardo
```

ä½¿ç”¨ `vim` ç¼–è¾‘å™¨é€šè¿‡ `visudo` å‘½ä»¤ç¼–è¾‘ sudoers æ–‡ä»¶ï¼š

```bash
EDITOR=vim visudo # è¿™é‡Œéœ€è¦æ˜¾å¼çš„æŒ‡å®šç¼–è¾‘å™¨ï¼Œå› ä¸ºä¸Šé¢çš„ç¯å¢ƒå˜é‡è¿˜æœªç”Ÿæ•ˆ
```

æ‰¾åˆ°å¦‚ä¸‹è¿™æ ·çš„ä¸€è¡Œï¼ŒæŠŠå‰é¢çš„æ³¨é‡Šç¬¦å· # å»æ‰ï¼š

```
#%wheel ALL=(ALL:ALL) ALL
```

## 2. å¼€å¯ 32 ä½æ”¯æŒåº“ä¸ Arch Linux ä¸­æ–‡ç¤¾åŒºä»“åº“ï¼ˆarchlinuxcnï¼‰

é€šè¿‡ `vim /etc/pacman.conf` ç¼–è¾‘ã€‚

å»æ‰ `[multilib]` ä¸€èŠ‚ä¸­ä¸¤è¡Œçš„æ³¨é‡Šï¼Œæ¥å¼€å¯ 32 ä½åº“æ”¯æŒã€‚

åœ¨æ–‡æ¡£ç»“å°¾å¤„åŠ å…¥ä¸‹é¢çš„æ–‡å­—ï¼Œæ¥æ·»åŠ  archlinuxcn æºã€‚æ¨èçš„é•œåƒæºï¼ˆé€‰ä¸€ä¸ªå³å¯ï¼‰ä¹Ÿä¸€å¹¶åˆ—å‡ºï¼š

```
[archlinuxcn]
Server = https://mirrors.ustc.edu.cn/archlinuxcn/$arch # ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦å¼€æºé•œåƒç«™
Server = https://mirrors.tuna.tsinghua.edu.cn/archlinuxcn/$arch # æ¸…åå¤§å­¦å¼€æºè½¯ä»¶é•œåƒç«™
Server = https://mirrors.hit.edu.cn/archlinuxcn/$arch # å“ˆå°”æ»¨å·¥ä¸šå¤§å­¦å¼€æºé•œåƒç«™
Server = https://repo.huaweicloud.com/archlinuxcn/$arch # åä¸ºå¼€æºé•œåƒç«™
```

> archlinuxcn ä»“åº“æœåŠ¡å™¨ä½äºæ¬§æ´²ï¼Œåœ¨ä¸­å›½å¤§é™†ã€ä¸­å›½é¦™æ¸¯ã€ç¾å›½æœ‰é•œåƒã€‚

```bash
pacman -Syyu
```

é‡å¯å¹¶ç”¨åˆšåˆšåˆ›å»ºçš„ç”¨æˆ·ç™»å½•ã€‚

---

**è¡¥å……çŸ¥è¯†ï¼š**

`pacman -Syu`: å¸¸è§„æ›´æ–°

`pacman -Syyu`: åªåœ¨é‡åˆ°é—®é¢˜æˆ–æ›´æ¢é•œåƒæ—¶ä½¿ç”¨

`-S`: sync â†’ å®‰è£…æˆ–æ›´æ–°è½¯ä»¶åŒ…

`-y`: refresh â†’ åŒæ­¥è½¯ä»¶åŒ…æ•°æ®åº“ï¼ˆå³æ›´æ–°æœ¬åœ°æ•°æ®åº“ç´¢å¼•ï¼‰

`-yy`: å¼ºåˆ¶åˆ·æ–°æ•°æ®åº“ï¼Œå³ä½¿æ•°æ®åº“çœ‹èµ·æ¥æ˜¯æœ€æ–°çš„

`-u`: upgrade â†’ å‡çº§å·²å®‰è£…çš„æ‰€æœ‰è½¯ä»¶åŒ…

---

## 3. ï¼ˆå¯é€‰ï¼Œä¿å®ˆï¼‰å®‰è£…KDEæ¡Œé¢ç¯å¢ƒ

```bash
pacman -S plasma-meta dolphin kitty
```

kde é»˜è®¤å®‰è£…çš„æ˜¯ xorg ï¼Œå¦‚æœæƒ³ä½¿ç”¨ wayland çš„è¯å®‰è£…ä»¥ä¸‹åŒ…ï¼š

```bash
pacman -S plasma-workspace xdg-desktop-portal egl-wayland
```

å¼€å¯ sddm.service å®ˆæŠ¤è¿›ç¨‹ï¼š

```bash
systemctl enable sddm
```

é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯åŠ¨æ˜¾ç¤ºç®¡ç†å™¨æˆ–é‡å¯ç”µè„‘ï¼Œå³å¯çœ‹åˆ°æ¬¢è¿ç•Œé¢ï¼š

```bash
systemctl start sddm
```

é‡å¯ç”µè„‘ï¼š

```bash
reboot
```

## 4. ï¼ˆå¯é€‰ï¼ŒæŠ˜è…¾ï¼‰å®‰è£…niri

å®‰è£…paruï¼š

```bash
sudo pacman -S --needed base-devel
git clone https://aur.archlinux.org/paru.git
cd paru
makepkg -si

sudo pacman -S archlinuxcn-keyring                      # cn æºä¸­çš„ç­¾åï¼ˆarchlinuxcn-keyring åœ¨ archlinuxcnï¼‰
```

```bash
paru -S kitty git
paru -S zen-browser-bin zen-browser-i18n-zh-cn
paru -S clash-verge-rev-bin
paru -S niri xdg-desktop-portal xdg-desktop-portal-gtk egl-wayland

# dmsæ¡Œé¢
curl -fsSL https://install.danklinux.com | sh
dms greeter install
```

è®¾ç½®ä¸­æ–‡`vim .config/locale.conf`

```
LANG=zh_CN.UTF-8
LANGUAGE=zh_CN.UTF-8
LC_ADDRESS=zh_CN.UTF-8
LC_COLLATE=zh_CN.UTF-8
LC_CTYPE=zh_CN.UTF-8
LC_IDENTIFICATION=zh_CN.UTF-8
LC_MEASUREMENT=zh_CN.UTF-8
LC_MESSAGES=zh_CN.UTF-8
LC_MONETARY=zh_CN.UTF-8
LC_NAME=zh_CN.UTF-8
LC_NUMERIC=zh_CN.UTF-8
LC_PAPER=zh_CN.UTF-8
LC_TELEPHONE=zh_CN.UTF-8
LC_TIME=zh_CN.UTF-8
```

äº’æ¢escå’Œcapé”®ç”¨`keyd`

å®‰è£…è¾“å…¥æ³•ï¼š

```bash
sudo pacman -S fcitx5-im             # è¾“å…¥æ³•åŸºç¡€åŒ…ç»„
sudo pacman -S fcitx5-chinese-addons # å®˜æ–¹ä¸­æ–‡è¾“å…¥å¼•æ“
sudo pacman -S fcitx5-material-color # è¾“å…¥æ³•ä¸»é¢˜
```

é€šè¿‡ `vim ~/.config/environment.d/im.conf` ç¼–è¾‘ï¼š

```bash
XMODIFIERS=@im=fcitx
```


## 5. å®‰è£…åŸºç¡€åŠŸèƒ½åŒ…

é€šè¿‡ `vim ~/.bashrc` ç¼–è¾‘ï¼š

```bash
sudo pacman -S neovim
export EDITOR='nvim'
```

```bash
sudo pacman -S clash-verge-rev-bin

sudo pacman -S sof-firmware alsa-firmware alsa-ucm-conf # å£°éŸ³å›ºä»¶
sudo pacman -S ntfs-3g                                  # ä½¿ç³»ç»Ÿå¯ä»¥è¯†åˆ« NTFS æ ¼å¼çš„ç¡¬ç›˜
sudo pacman -S archlinuxcn-keyring                      # cn æºä¸­çš„ç­¾åï¼ˆarchlinuxcn-keyring åœ¨ archlinuxcnï¼‰

sudo pacman -S adobe-source-han-serif-cn-fonts wqy-zenhei                  # å®‰è£…å‡ ä¸ªå¼€æºä¸­æ–‡å­—ä½“ã€‚
sudo pacman -S noto-fonts noto-fonts-cjk noto-fonts-emoji noto-fonts-extra # å®‰è£…è°·æ­Œå¼€æºå­—ä½“åŠè¡¨æƒ…

sudo pacman -S zen-browser-bin zen-browser-i18n-zh-cn
sudo pacman -S steam # æ¸¸æˆå•†åº—ã€‚ç¨åçœ‹å®Œæ˜¾å¡é©±åŠ¨ç« èŠ‚å†ä½¿ç”¨

# # å¯é€‰
# sudo pacman -S gwenview # å›¾ç‰‡æŸ¥çœ‹å™¨
# sudo pacman -S ark # å‹ç¼©è½¯ä»¶ã€‚åœ¨ dolphin ä¸­å¯ç”¨å³é”®è§£å‹å‹ç¼©åŒ…
# sudo pacman -S packagekit-qt6 packagekit appstream-qt appstream # ç¡®ä¿ Discoverï¼ˆè½¯ä»¶ä¸­å¿ƒï¼‰å¯ç”¨ï¼Œéœ€é‡å¯
```


å®‰è£…è¾“å…¥æ³•ï¼š

```bash
sudo pacman -S fcitx5-im             # è¾“å…¥æ³•åŸºç¡€åŒ…ç»„
sudo pacman -S fcitx5-chinese-addons # å®˜æ–¹ä¸­æ–‡è¾“å…¥å¼•æ“
sudo pacman -S fcitx5-material-color # è¾“å…¥æ³•ä¸»é¢˜
```

é€šè¿‡ `vim ~/.config/environment.d/im.conf` ç¼–è¾‘ï¼š

```bash
GTK_IM_MODULE=fcitx
QT_IM_MODULE=fcitx
XMODIFIERS=@im=fcitx
SDL_IM_MODULE=fcitx
GLFW_IM_MODULE=ibus
```

å¦‚æœä½¿ç”¨ Wayland è€Œé X11ï¼š

```bash
XMODIFIERS=@im=fcitx
```

å¯åŠ¨è“ç‰™ï¼š

```bash
sudo systemctl enable --now bluetooth
```

## 6. å®‰è£…è®¾ç½® Timeshift

è®¾ç½® Timeshift å¿«ç…§ï¼š

```bash
sudo pacman -S timeshift
sudo systemctl enable --now cronie.service

timeshift
```

å®Œæˆåå»ºè®®æ‰§è¡Œä¸‹è¿°æŒ‡ä»¤åˆ é™¤ subvolidï¼š

```bash
sudo sed -i -E 's/(subvolid=[0-9]+,)|(,subvolid=[0-9]+)//g' /etc/fstab
```

é€šè¿‡å®‰è£… `grub-btrfs` åŒ…ï¼Œå¯ä»¥å®ç°åœ¨æ¯æ¬¡ä½¿ç”¨ `grub-mkconfig` é‡æ–°ç”Ÿæˆ GRUB å¯åŠ¨é¡¹æ—¶ï¼Œè‡ªåŠ¨æ·»åŠ å¿«ç…§çš„å¯åŠ¨å…¥å£ã€‚
å¦‚æœå¸Œæœ›åœ¨ Timeshift è‡ªåŠ¨åˆ›å»ºå¿«ç…§çš„èƒ½å¤ŸåŒæ—¶è‡ªåŠ¨ç”Ÿæˆå¯åŠ¨é¡¹ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤è¿è¡Œ `grub-btrfsd.service` å¹¶å°†å…¶é…ç½®ä¸ºè‡ªåŠ¨å¯åŠ¨ï¼š

```bash
sudo systemctl enable --now grub-btrfsd.service
```

ç”±äºè¯¥æœåŠ¡é»˜è®¤çš„ç›‘è§†è·¯å¾„ä¸º `/.snapshots`ï¼Œå› æ­¤è¿˜éœ€è¦å¯¹è¯¥è·¯å¾„è¿›è¡Œä¿®æ”¹ï¼Œä½ éœ€è¦ï¼š

1. è¦†ç›–é»˜è®¤é…ç½®

```bash
sudo systemctl edit grub-btrfsd.service
```

åœ¨é»˜è®¤çš„å…‰æ ‡ä½ç½®ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹åä¿å­˜å¹¶é€€å‡º

```bash
[Service]
ExecStart=
ExecStart=/usr/bin/grub-btrfsd --syslog --timeshift-auto
```

2. é‡è½½å¹¶é‡å¯æœåŠ¡ï¼š

```bash
sudo systemctl daemon-reload
sudo systemctl restart grub-btrfsd.service
```

> ç›®å‰ï¼ˆv24.06.3ï¼‰Timeshift åˆ›å»ºçš„å¿«ç…§é»˜è®¤æ˜¯å¯è¯»å¯å†™ï¼Œå¹¶ä¸”æ²¡æœ‰æä¾›åˆ›å»ºåªè¯»å¿«ç…§çš„åŠŸèƒ½ã€‚
>
> å¦‚æœä½ ä¸æ˜¯ä½¿ç”¨ Timeshift å¯¹ç³»ç»Ÿè¿›è¡Œå¿«ç…§ç®¡ç†ï¼Œè€Œæ˜¯ä½¿ç”¨å…¶å®ƒå·¥å…·ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°ç”±äºåˆ›å»ºäº†åªè¯»å¿«ç…§å¯¼è‡´æ— æ³•æ­£å¸¸å¯åŠ¨åˆ°å¿«ç…§ç³»ç»Ÿçš„é—®é¢˜ï¼Œä½ éœ€è¦é€šè¿‡ btrfs property set ä¿®æ”¹å¿«ç…§çš„è¯»å†™å±æ€§æ‰èƒ½è§£å†³ã€‚
>
> å¯¹æ­¤ï¼Œgrub-btrfs æä¾›äº†ä¸€ä¸ªinitramfs hookï¼Œä½ å¯ä»¥æ·»åŠ è¿™ä¸ªåä¸º grub-btrfs-overlayfs çš„ hookï¼Œä½¿ç”¨ overlayfs çš„æ–¹å¼å¯åŠ¨åªè¯»å¿«ç…§ã€‚
>
> è¿™æ ·æ¯å½“å¯åŠ¨åˆ°åªè¯»å¿«ç…§æ—¶ï¼Œæ‰€æœ‰çš„å†™æ“ä½œéƒ½ä¼šè¢«é‡å®šå‘åˆ° overlayfs çš„ upper å±‚ï¼Œä¹Ÿå°±æ˜¯å°†æ•°æ®å†™å…¥åˆ°å†…å­˜ä¸­ï¼Œè€Œä¸ä¼šå½±å“åˆ°å¿«ç…§æœ¬èº«ï¼Œå°±åƒ live-cd ä¸€æ ·ã€‚
>
> ä½ éœ€è¦ç¼–è¾‘ /etc/mkinitcpio.conf
>
> sudo -e /etc/mkinitcpio.conf
>
> 1
>
> æ‰¾åˆ° HOOKSï¼Œå¹¶åœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ  grub-btrfs-overlayfsï¼Œå°±åƒè¿™æ ·:
>
> HOOKS=(base udev autodetect microcode modconf keyboard keymap consolefont block filesystems fsck resume numlock grub-btrfs-overlayfs)
>
> 1
>
> å¹¶é‡æ–°ç”Ÿæˆ initramfs:
>
> sudo mkinitcpio -P

## 7. v2rayå’Œv2rayA

dddd

```bash
sudo pacman -S v2ray v2raya
sudo systemctl enable --now v2raya

# æˆ–è€…
paru -S clash-verge-rev-bin
```

## 8. æ˜¾å¡é©±åŠ¨

### 1. é›†æ˜¾ï¼ˆintelï¼‰

```bash
sudo pacman -S mesa lib32-mesa vulkan-intel lib32-vulkan-intel
```

### 2. ç‹¬æ˜¾ï¼ˆnvidiaï¼‰

```bash
sudo pacman -S nvidia nvidia-settings lib32-nvidia-utils # å¿…é¡»å®‰è£…
```

### 3. åŒæ˜¾å¡

ğŸš§ æ–½å·¥ä¸­
